<div class="editor-preview-container">
  <!-- Left Panel - Form -->
   <div class="form-panel">
    <h2>Certificate Details</h2>

    <form [formGroup]="certificateForm">
      <div class="form-group">
        <label>Recipient Name*</label>
        <input type="text" formControlName="recipientName" />
        <div *ngIf="f['recipientName'].invalid && f['recipientName'].touched" class="error">
          Name is required (max 50 characters)
        </div>
      </div>

      <div class="form-group">
        <label>Project Name*</label>
        <input type="text" formControlName="projectName" />
        <div *ngIf="f['projectName'].invalid && f['projectName'].touched" class="error">
          Project Name is required (max 50 characters)
        </div>
      </div>

      <div class="form-group">
        <label>Date of Issue*</label>
        <input type="date" formControlName="issueDate" />
        <div *ngIf="f['issueDate'].invalid && f['issueDate'].touched" class="error">
          Date of issue is required.
        </div>
      </div>

      <div class="form-group">
        <label>Batch Month*</label>
        <select formControlName="batchMonth">
          <option *ngFor="let month of months" [value]="month">{{ month }}</option>
        </select>
        <div *ngIf="f['batchMonth'].invalid && f['batchMonth'].touched" class="error">
          Batch month is required.
        </div>
      </div>

      <div class="form-group">
        <label>Batch Year*</label>
        <input type="number" formControlName="batchYear" min="2000" max="2100">
        <div *ngIf="f['batchYear'].invalid && f['batchYear'].touched" class="error">
          Batch year is required.
        </div>
      </div>

      <div class="form-group">
        <label>Number of Signatories*</label>
        <select formControlName="numberOfSignatories" (change)="onSignatoriesChange()">
          <option value="1">1 Signatory</option>
          <option value="2">2 Signatories</option>
        </select>
      </div>

      <!-- Signatory 1 -->
      <div class="form-group">
        <label>Signatory 1 Name*</label>
        <input type="text" formControlName="signatory1Name" />
        <div *ngIf="f['signatory1Name'].invalid && f['signatory1Name'].touched" class="error">
          Signatory name is required.
        </div>
      </div>

      <div class="form-group">
        <label>Signatory 1 Role*</label>
        <input type="text" formControlName="signatory1Role" />
        <div *ngIf="f['signatory1Role'].invalid && f['signatory1Role'].touched" class="error">
          Signatory role is required.
        </div>
      </div>

      <!-- Signatory 2 -->
      <div class="form-group" *ngIf="certificateForm.value.numberOfSignatories === '2'">
        <label>Signatory 2 Name*</label>
        <input type="text" formControlName="signatory2Name" />
        <div *ngIf="f['signatory2Name'].invalid && f['signatory2Name'].touched" class="error">
          Signatory name is required.
        </div>
      </div>

      <div class="form-group" *ngIf="certificateForm.value.numberOfSignatories === '2'">
        <label>Signatory 2 Role*</label>
        <input type="text" formControlName="signatory2Role" />
        <div *ngIf="f['signatory2Role'].invalid && f['signatory2Role'].touched" class="error">
          Signatory role is required.
        </div>
      </div>

      <div class="button-group">
        <button type="button" (click)="goBack()" class="btn secondary">
          Back
        </button>
        <button type="button" class="btn btn-req" (click)="openCertificatePreview()">
          Preview & Request Approval
        </button>
      </div>
    </form>
   </div>

   <!-- Right Panel - Certificate Preview -->
    <div class="preview-panel">
      <div class="certificate" [style.backgroundImage]="'url(' + certificateBgImage + ')'">
        <div class="certificate-content">
          <div class="cert-img">
            <img src="its_logo.png" class="cert-logo" alt="Company Logo" style="width: 120px;">
          </div>
          <h1>CERTIFICATE OF APPRECIATION</h1>
          <p>This certificate of appreciation is awarded to</p>
          <h2>{{ certificateForm.value.recipientName || 'Recipient Name' }}</h2>
          <h3>INNOVATIVE PROJECT EXCELLENCE AWARD</h3>

          <h4>"{{ certificateForm.value.projectName || '[Project Name]' }}"</h4>

          <div class="certificate-text">
            <p>Awarded to <span class="iss-date">{{ certificateForm.value.recipientName || '[Recipient Name]' }}</span> for delivering the Best OJT Project among the <span class="iss-date">{{ certificateForm.value.batchMonth || '[Batch Month]' }} {{ certificateForm.value.batchYear || ']' }}</span> Internship Batch.</p>
            <p>Your work has set a benchmark in innovation, dedication, and excellence.</p>
          </div>

          <p class="issuance">
            Given on this day of <span class="iss-date">{{ (certificateForm.value.issueDate | date:'longDate') || 'December 7, ' + currentYear }}</span> at <span class="iss-date">IT Squarehub Global Services Corporation, Angeles City, Pampanga.</span>
          </p>

          <div class="signatures" [class.center-signature]="certificateForm.value.numberOfSignatories === '1'">
            <div>
              <div class="signature-line"></div>
              <p class="sig-names">{{ certificateForm.value.signatory1Name || 'Signatory 1 Name' }}</p>
              <p class="sig-roles">{{ certificateForm.value.signatory1Role || 'Chief Executive Officer' }}</p>
            </div>

            <div *ngIf="certificateForm.value.numberOfSignatories === '2'">
              <div class="signature-line"></div>
              <p class="sig-names">{{ certificateForm.value.signatory2Name || 'Signatory 2 Name' }}</p>
              <p class="sig-roles">{{ certificateForm.value.signatory2Role || 'Chief Finance & Operating Officer' }}</p>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Preview & Approval Modal -->
     <div *ngIf="showCertificatePreview" class="popup-overlay">
      <div class="popup-content">
        <h3>Certificate Preview & Request Approval</h3>

        <!-- Certificate Capture -->
         <div #modalCertificate class="certificate" [style.backgroundImage]="'url(' + certificateBgImage + ')'">
          <div class="certificate-content">
            <div class="cert-img">
              <img src="its_logo.png" class="cert-logo" alt="Company Logo" style="width: 120px;">
            </div>
            <h1 style="margin-top: -0.5em;">CERTIFICATE OF APPRECIATION</h1>
            <p style="margin-top: 1.2em;">This certificate of appreciation is awarded to</p>
            <h2>{{ certificateForm.value.recipientName || 'Recipient Name' }}</h2>
            <h3 style="padding-bottom: 1.2em">INNOVATIVE PROJECT EXCELLENCE AWARD</h3>

            <h4>"{{ certificateForm.value.projectName || '[Project Name]' }}"</h4>

            <div class="certificate-text">
              <p>Awarded to <span class="iss-date">{{ certificateForm.value.recipientName || '[Recipient Name]' }}</span> for delivering the Best OJT Project among the <span class="iss-date">{{ certificateForm.value.batchMonth || '[Batch Month]' }} {{ certificateForm.value.batchYear || ']' }}</span> Internship Batch.</p>
              <p>Your work has set a benchmark in innovation, dedication, and excellence.</p>
            </div>


            <p class="issuance" style="padding-bottom: 1.2em">
               Given on this day of <span class="iss-date">{{ (certificateForm.value.issueDate | date:'longDate') || 'December 7, ' + currentYear }}</span> at <span class="iss-date">IT Squarehub Global Services Corporation, Angeles City, Pampanga.</span>
            </p>

            <div class="signatures" style="margin-bottom: 1em;" [class.center-signature]="certificateForm.value.numberOfSignatories === '1'">
              <div>
                <div class="signature-line"></div>
                <p class="sig-names">{{ certificateForm.value.signatory1Name || 'Signatory 1 Name' }}</p>
                <p class="sig-roles">{{ certificateForm.value.signatory1Role || 'Chief Executive Officer' }}</p>
              </div>

              <div *ngIf="certificateForm.value.numberOfSignatories === '2'">
                <div class="signature-line"></div>
                <p class="sig-names">{{ certificateForm.value.signatory2Name || 'Signatory 2 Name' }}</p>
                <p class="sig-roles">{{ certificateForm.value.signatory2Role || 'Chief Finance & Operating Officer' }}</p>
              </div>
            </div>
          </div>
        </div>

         <!-- Dynamic Approval Form -->
          <form [formGroup]="approvalForm" (ngSubmit)="submitApprovalFromPreview()">
            <div *ngFor="let signatory of signatories; let i = index">
              <div class="form-group">
                <label>Approver {{ i + 1 }} Name*</label>
                <input type="text" [formControlName]="'approverName' + i" />
                <div *ngIf="approvalForm.get('approverName' + i)?.invalid && approvalForm.get('approverName' + i)?.touched" class="error">
                  Name is Required
                </div>
              </div>

              <div class="form-group">
                <label>Approver {{ i + 1 }} Email*</label>
                <input type="email" [formControlName]="'approverEmail' + i" />
                <div *ngIf="approvalForm.get('approverEmail' + i)?.invalid && approvalForm.get('approverEmail' + i)?.touched" class="error">
                  Valid email is required.
                </div>
              </div>
            </div>
            <div class="form-group">
              <label>Creator Name*</label>
              <input type="text" formControlName="creatorName" />
              <div *ngIf="approvalForm.get('creatorName')?.invalid && approvalForm.get('creatorName')?.touched" class="error">
                Creator name is required.
              </div>
            </div>
            <div class="modal-actions">
              <button type="submit" class="btn btn-req">Submit for Approval</button>
              <button type="button" (click)="closeCertificatePreview()" class="btn close-btn">Close</button>
            </div>
          </form>
    </div>
  </div>
</div>