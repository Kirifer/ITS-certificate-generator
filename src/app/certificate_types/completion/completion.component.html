<div class="editor-preview-container">
  <!-- Left Panel - Form -->
  <div class="form-panel">
    <h2>Certificate Details</h2>
    <form [formGroup]="certificateForm" (ngSubmit)="requestApproval()">
      <div class="form-group">
        <label>Recipient Name*</label>
        <input type="text" formControlName="recipientName" />
        <div *ngIf="f['recipientName'].invalid && f['recipientName'].touched" class="error">
          Name is required (max 50 characters)
        </div>
      </div>

      <div class="form-group">
        <label>Pronoun*</label>
        <select formControlName="pronoun" class="form-control">
          <option value="" disabled selected>Select pronoun</option>
          <option value="his">His</option>
          <option value="her">Her</option>
        </select>
        <div *ngIf="f['pronoun'].invalid && f['pronoun'].touched" class="error">
          Pronoun is required.
        </div>
      </div>

      <div class="form-group">
        <label>Date of Issue*</label>
        <input type="date" formControlName="issueDate" />
        <div *ngIf="f['issueDate'].invalid && f['issueDate'].touched" class="error">
          Date of issue is required.
        </div>
      </div>

      <div class="form-group">
        <label>Signatory 1 Name*</label>
        <input type="text" formControlName="signatory1Name" />
        <div *ngIf="f['signatory1Name'].invalid && f['signatory1Name'].touched" class="error">
          Signatory name is required.
        </div>
      </div>

      <div class="form-group">
        <label>Signatory 1 Role*</label>
        <input type="text" formControlName="signatory1Role" />
        <div *ngIf="f['signatory1Role'].invalid && f['signatory1Role'].touched" class="error">
          Signatory role is required.
        </div>
      </div>

      <div class="form-group">
        <label>Signatory 2 Name*</label>
        <input type="text" formControlName="signatory2Name" />
        <div *ngIf="f['signatory2Name'].invalid && f['signatory2Name'].touched" class="error">
          Signatory name is required.
        </div>
      </div>

      <div class="form-group">
        <label>Signatory 2 Role*</label>
        <input type="text" formControlName="signatory2Role" />
        <div *ngIf="f['signatory2Role'].invalid && f['signatory2Role'].touched" class="error">
          Signatory role is required.
        </div>
      </div>

      <div class="button-group">
        <button type="button" (click)="goBack()" class="btn secondary">Back</button>
        <button type="button" class="btn btn-req" (click)="openModal()">Request Approval</button>
      </div>
    </form>
  </div>

  <!-- Modal Popup -->
  <div class="custom-modal-backdrop" *ngIf="isModalOpen">
    <div class="custom-modal">
      <button class="close-button" (click)="closeModal()">Ã—</button>
      <h2>REQUEST APPROVAL</h2>
      <form #requestForm="ngForm" (ngSubmit)="submitForm(requestForm)">
        <div class="form-group">
          <label for="name">Name</label>
          <input type="text" id="name" name="name" ngModel required />
        </div>
        <div class="form-group">
          <label for="email">Email</label>
          <input type="email" id="email" name="email" ngModel required />
        </div>
        <div class="modal-actions">
          <button type="button" class="btn-cancel" (click)="closeModal()">Cancel</button>
          <button type="submit" [disabled]="requestForm.invalid">Submit</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Right Panel - Static Preview -->
  <div class="preview-panel">
    <div
      id="staticCertificate"
      class="certificate"
      [style.backgroundImage]="'url(' + certificateBgImage + ')'"
      style="width: 11.5in; height: 9.5in;"
    >
      <div class="certificate-content">
        <h1 style="font-size: 50px; margin-top: -20px;">CERTIFICATE OF COMPLETION</h1>
        <p style="margin-top: -120px; font-size: 20px;">This is to Certify that</p>
        <h2>{{ certificateForm.value.recipientName || 'Recipient Name' }}</h2>

        <div class="certificate-text">
          <p>{{ (certificateForm.value.pronoun ? (certificateForm.value.pronoun | titlecase) : '[His/Her]') }} exceptional dedication, hard work, and unwavering commitment to IT Squarehub have exceptionally</p>
          <p>contributed to the success of our organization.</p>
          <p>Congratulations on this well-deserved honor and our gratitude for your outstanding contributions.</p>
        </div>

        <p class="issuance">
          Given on this day of
          <span class="iss-date">{{ (certificateForm.value.issueDate | date:'longDate') || 'December 7, ' + currentYear }}</span>
          at
          <span class="iss-date">IT Squarehub Global Services Corporation, Angeles City, Pampanga.</span>
        </p>

        <div class="signatures">
          <div>
            <div class="signature-line"></div>
            <p class="sig-names">{{ certificateForm.value.signatory1Name || 'Signatory 1 Name' }}</p>
            <p class="sig-roles">{{ certificateForm.value.signatory1Role || 'Chief Executive Officer' }}</p>
          </div>
          <div>
            <div class="signature-line"></div>
            <p class="sig-names">{{ certificateForm.value.signatory2Name || 'Signatory 2 Name' }}</p>
            <p class="sig-roles">{{ certificateForm.value.signatory2Role || 'Chief Finance & Operating Officer' }}</p>
          </div>
        </div>
      </div>
    </div>

    <button (click)="openCertificatePreview()" class="btn print-btn bg-blue-200">
      Preview Certificate
    </button>

    <!-- Certificate Preview Popup -->
    <div *ngIf="showCertificatePreview" class="popup-overlay">
      <div class="popup-content">
        <div
          #certificatePreview
          id="popupCertificate"
          class="certificate"
          [style.backgroundImage]="'url(' + certificateBgImage + ')'"
          style="width: 11.5in; height: 9.5in;"
        >
          <div class="certificate-content">
            <h1 style="font-size: 50px;">CERTIFICATE OF COMPLETION</h1>
            <p style="margin-top: -160px;">This is to Certify that</p>
            <h2>{{ certificateForm.value.recipientName || 'Recipient Name' }}</h2>

            <div class="certificate-text">
              <p>
                {{ (certificateForm.value.pronoun ? (certificateForm.value.pronoun | titlecase) : '[His/Her]') }} exceptional dedication, hard work, and unwavering commitment to IT Squarehub have exceptionally
                contributed to the success of our organization.
              </p>
              <p>Congratulations on this well-deserved honor and our gratitude for your outstanding contributions.</p>
            </div>

            <p class="issuance">
              Given on this day of
              <span class="iss-date">{{ (certificateForm.value.issueDate | date:'longDate') || 'December 7, ' + currentYear }}</span>
              at
              <span class="iss-date">IT Squarehub Global Services Corporation, Angeles City, Pampanga.</span>
            </p>

            <div class="signatures">
              <div>
                <div class="signature-line"></div>
                <p class="sig-names">{{ certificateForm.value.signatory1Name || 'Signatory 1 Name' }}</p>
                <p class="sig-roles">{{ certificateForm.value.signatory1Role || 'Chief Executive Officer' }}</p>
              </div>
              <div>
                <div class="signature-line"></div>
                <p class="sig-names">{{ certificateForm.value.signatory2Name || 'Signatory 2 Name' }}</p>
                <p class="sig-roles">{{ certificateForm.value.signatory2Role || 'Chief Finance & Operating Officer' }}</p>
              </div>
            </div>
          </div>
        </div>
        <button (click)="closeCertificatePreview()" class="btn close-btn">Close</button>
      </div>
    </div>
  </div>
</div>
