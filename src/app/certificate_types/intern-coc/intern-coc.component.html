<div class="editor-preview-container">
  <!-- Left Panel - Form -->
  <div class="form-panel">
    <h2>Certificate Details</h2>

    <form [formGroup]="certificateForm">
      <div class="form-group">
        <label>Recipient Name*</label>
        <input type="text" formControlName="recipientName" />
        <div *ngIf="f['recipientName'].invalid && f['recipientName'].touched" class="error">
          Name is required (max 50 characters)
        </div>
      </div>

      <div class="form-group">
        <label>Number of Hours*</label>
        <input type="text" formControlName="numberOfHours">
        <div *ngIf="f['numberOfHours'].invalid && f['numberOfHours'].touched" class="error">
          Number of Hours Completed is required
        </div>
      </div>

      <div class="form-group">
        <label>Intern's Position*</label>
        <input type="text" formControlName="internsPosition">
        <div *ngIf="f['internsPosition'].invalid && f['internsPosition'].touched" class="error">
          This field is required
        </div>
      </div>

      <div class="form-group">
        <label>Intern's Department*</label>
        <input type="text" formControlName="internsDepartment">
        <div *ngIf="f['internsDepartment'].invalid && f['internsDepartment'].touched" class="error">
          This field is required
        </div>
      </div>

      <div class="form-group">
        <label>Pronoun*</label>
        <select formControlName="pronoun" class="form-control">
          <option value="" disabled selected>Select pronoun</option>
          <option value="his">his</option>
          <option value="her">her</option>
        </select>
        <div *ngIf="f['pronoun'].invalid && f['pronoun'].touched" class="error">
          Pronoun is required.
        </div>
      </div>

      <div class="form-group">
        <label>Number of Signatories*</label>
        <select formControlName="numberOfSignatories" (change)="onSignatoriesChange()">
          <option value="1">1 Signatory</option>
          <option value="2">2 Signatories</option>
        </select>
      </div>

      <!-- Signatory 1 -->
      <div class="form-group">
        <label>Signatory 1 Name*</label>
        <input type="text" formControlName="signatory1Name" />
        <div *ngIf="f['signatory1Name'].invalid && f['signatory1Name'].touched" class="error">
          Signatory name is required.
        </div>
      </div>

      <div class="form-group">
        <label>Signatory 1 Role*</label>
        <input type="text" formControlName="signatory1Role" />
        <div *ngIf="f['signatory1Role'].invalid && f['signatory1Role'].touched" class="error">
          Signatory role is required.
        </div>
      </div>

      <!-- Signatory 2 -->
      <div class="form-group" *ngIf="certificateForm.value.numberOfSignatories === '2'">
        <label>Signatory 2 Name*</label>
        <input type="text" formControlName="signatory2Name" />
        <div *ngIf="f['signatory2Name'].invalid && f['signatory2Name'].touched" class="error">
          Signatory name is required.
        </div>
      </div>

      <div class="form-group" *ngIf="certificateForm.value.numberOfSignatories === '2'">
        <label>Signatory 2 Role*</label>
        <input type="text" formControlName="signatory2Role" />
        <div *ngIf="f['signatory2Role'].invalid && f['signatory2Role'].touched" class="error">
          Signatory role is required.
        </div>
      </div>

      <div class="button-group">
        <button type="button" (click)="goBack()" class="btn secondary">
          Back
        </button>
        <button type="button" class="btn btn-req" (click)="openCertificatePreview()">
          Preview & Request Approval
        </button>
      </div>
    </form>
  </div>

  <!-- Right Panel - Certificate Preview -->
  <div class="preview-panel">
    <div class="certificate" [style.backgroundImage]="'url(' + certificateBgImage + ')'">
      <div class="certificate-content">
        <div class="cert-img">

        </div>

        <h1>CERTIFICATE OF COMPLETION</h1>
        <div class="certificate-text">
          <p style="text-align:justify">This is to certify that <span class="font-bold">{{ certificateForm.value.recipientName }}</span> has successfully completed <span class="font-bold">{{ certificateForm.value.numberOfHours }} hours</span> as a <span class="font-bold">{{ certificateForm.value.internsPosition }} Intern</span> under the <span class="font-bold">{{ certificateForm.value.internsDepartment }} Department</span> at <span class="font-bold">IT SQUAREHUB GLOBAL SERVICES CORPORATION.</span></p>

          <br><br>

          <p>During this internship, {{ certificateForm.value.recipientName }} has demonstrated exceptional dedication, enthusiasm, and commitment to learning. We hereby acknowledge {{ certificateForm.value.recipientName }} for {{ certificateForm.value.pronoun }} outstanding performance and contributions to our organization.</p>
        </div>

        <div class="signatures" [class.single-signature]="certificateForm.value.numberOfSignatories === '1'">
          <div>
            <p class="sig-names">{{ certificateForm.value.signatory1Name || 'Signatory 1 Name' }}</p>
            <p class="sig-roles">{{ certificateForm.value.signatory1Role || 'Chief Executive Officer' }}</p>
            <p class="sig-roles">IT Squarehub Global Services Corp.</p>
          </div>

          <div *ngIf="certificateForm.value.numberOfSignatories === '2'">
            <p class="sig-names">{{ certificateForm.value.signatory2Name || 'Signatory 2 Name' }}</p>
            <p class="sig-roles">{{ certificateForm.value.signatory2Role || 'Chief Finance & Operating Officer' }}</p>
            <p class="sig-roles">IT Squarehub Global Services Corp.</p>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Preview & Approval Modal -->
  <div *ngIf="showCertificatePreview" class="popup-overlay">
    <div class="popup-content">
      <h3 style="margin-bottom: 1em;">Certificate Preview & Request Approval</h3>

      <!-- Certificate Capture -->
      <div class="capture-container">
      <div #modalCertificate class="certificate" [style.backgroundImage]="'url(' + certificateBgImage + ')'">
        <div class="certificate-content">
          <div class="cert-img">

          </div>
          <h1>CERTIFICATE OF COMPLETION</h1>
          <div class="certificate-text">
            <p style="text-align:justify">This is to certify that <span class="font-bold">{{ certificateForm.value.recipientName }}</span> has successfully completed <span class="font-bold">{{ certificateForm.value.numberOfHours }} hours</span> as a <span class="font-bold">{{ certificateForm.value.internsPosition }} Intern</span> under the <span class="font-bold">{{ certificateForm.value.internsDepartment }} Department</span> at <span class="font-bold">IT SQUAREHUB GLOBAL SERVICES CORPORATION.</span></p>

            <br><br>

            <p>During this internship, {{ certificateForm.value.recipientName }} has demonstrated exceptional dedication, enthusiasm, and commitment to learning. We hereby acknowledge {{ certificateForm.value.recipientName }} for {{ certificateForm.value.pronoun }} outstanding performance and contributions to our organization.</p>
          </div>

          <div class="signatures" [class.single-signature]="certificateForm.value.numberOfSignatories === '1'">
            <div>
              <p class="sig-names">{{ certificateForm.value.signatory1Name || 'Signatory 1 Name' }}</p>
              <p class="sig-roles">{{ certificateForm.value.signatory1Role || 'Chief Executive Officer' }}</p>
              <p class="sig-roles">IT Squarehub Global Services Corp.</p>
            </div>

            <div *ngIf="certificateForm.value.numberOfSignatories === '2'">
              <p class="sig-names">{{ certificateForm.value.signatory2Name || 'Signatory 2 Name' }}</p>
              <p class="sig-roles">{{ certificateForm.value.signatory2Role || 'Chief Finance & Operating Officer' }}</p>
              <p class="sig-roles">IT Squarehub Global Services Corp.</p>
            </div>
          </div>
        </div>
      </div>
      </div>

      <!-- Dynamic Approval Form -->
      <form [formGroup]="approvalForm" (ngSubmit)="submitApprovalFromPreview()" style="margin-top: 1em;">
        <div *ngFor="let signatory of signatories; let i = index">
          <div class="form-group">
            <label>Approver {{ i + 1 }} Name*</label>
            <input type="text" [formControlName]="'approverName' + i" />
            <div *ngIf="approvalForm.get('approverName' + i)?.invalid && approvalForm.get('approverName' + i)?.touched" class="error">
              Name is required.
            </div>
          </div>

          <div class="form-group">
            <label>Approver {{ i + 1 }} Email*</label>
            <input type="email" [formControlName]="'approverEmail' + i" />
            <div *ngIf="approvalForm.get('approverEmail' + i)?.invalid && approvalForm.get('approverEmail' + i)?.touched" class="error">
              Valid email is required.
            </div>
          </div>
        </div>

        <!-- Creator Name -->
          <div class="form-group">
            <label>Creator Name*</label>
            <input type="text" formControlName="creatorName" />
            <div *ngIf="approvalForm.get('creatorName')?.invalid && approvalForm.get('creatorName')?.touched" class="error">
              Creator name is required.
            </div>
          </div>

        <div class="modal-actions">
          <button type="submit" class="btn btn-req">Submit for Approval</button>
          <button type="button" (click)="closeCertificatePreview()" class="btn close-btn">Close</button>
        </div>
      </form>
    </div>
  </div>
</div>