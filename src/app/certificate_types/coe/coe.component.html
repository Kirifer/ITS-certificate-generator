<div class="editor-preview-container">
  <!-- Left Panel - Form -->
  <div class="form-panel">
    <h2>Certificate of Employment Details</h2>

    <form [formGroup]="certificateForm">
      <!-- Recipient -->
      <div class="form-group">
        <label>Employee Full Name*</label>
        <input type="text" formControlName="recipientName" />
        <div *ngIf="f['recipientName'].invalid && f['recipientName'].touched" class="error">
          Name is required (max 100 characters)
        </div>
      </div>

      <div class="form-group">
        <label>Employee ID*</label>
        <input type="text" formControlName="employeeId" />
        <div *ngIf="f['employeeId'].invalid && f['employeeId'].touched" class="error">
          Employee ID is required
        </div>
      </div>

      <div class="form-group">
        <label>Position*</label>
        <input type="text" formControlName="position">
        <div *ngIf="f['position'].invalid && f['position'].touched" class="error">
          Position is required
        </div>
      </div>

      <div class="form-group">
        <label>Employment Type*</label>
        <select formControlName="employmentType">
          <option value="Full-time">Full-time</option>
          <option value="Part-time">Part-time</option>
          <option value="Probationary">Probationary</option>
        </select>
        <div *ngIf="f['employmentType'].invalid && f['employmentType'].touched" class="error">
          Employment type is required
        </div>
      </div>

      <div class="form-group">
        <label>Start Date*</label>
        <input type="date" formControlName="startDate">
        <div *ngIf="f['startDate'].invalid && f['startDate'].touched" class="error">
          Start Date is required
        </div>
      </div>

      <div class="form-group">
        <label>End Date*</label>
        <input type="date" formControlName="endDate">
        <div *ngIf="f['endDate'].invalid && f['endDate'].touched" class="error">
          End Date is required
        </div>
      </div>

      <div class="form-group">
        <label>Salary in Words*</label>
        <input type="text" formControlName="salaryWords">
        <div *ngIf="f['salaryWords'].invalid && f['salaryWords'].touched" class="error">
          Salary is required
        </div>
      </div>

      <div class="form-group">
        <label>Salary in Figures*</label>
        <input type="number" formControlName="salaryFigures">
        <div *ngIf="f['salaryFigures'].invalid && f['salaryFigures'].touched" class="error">
          Salary is required
        </div>
      </div>

      <div class="form-group">
        <label>Issue Date*</label>
        <input type="date" formControlName="issueDate">
        <div *ngIf="f['issueDate'].invalid && f['issueDate'].touched" class="error">
          Date is required
        </div>
      </div>

      <div class="form-group">
        <label>Date Signed*</label>
        <input type="date" formControlName="dateSigned">
        <div *ngIf="f['dateSigned'].invalid && f['dateSigned'].touched" class="error">
          Date is required
        </div>
      </div>

      <!-- Company Contact Info -->
      <div class="form-group">
        <label>Company Phone*</label>
        <input type="text" formControlName="companyPhone" />
        <div *ngIf="f['companyPhone'].invalid && f['companyPhone'].touched" class="error">
          Phone is required.
        </div>
      </div>

      <div class="form-group">
        <label>Company Email*</label>
        <input type="email" formControlName="companyEmail" />
        <div *ngIf="f['companyEmail'].invalid && f['companyEmail'].touched" class="error">
          Valid email is required.
        </div>
      </div>

      <div class="form-group">
        <label>Number of Signatories*</label>
        <select formControlName="numberOfSignatories" (change)="onSignatoriesChange()">
          <option value="1">1 Signatory</option>
          <option value="2">2 Signatories</option>
        </select>
      </div>

      <!-- Signatory 1 -->
      <div class="form-group">
        <label>Signatory 1 Name*</label>
        <input type="text" formControlName="signatory1Name" />
        <div *ngIf="f['signatory1Name'].invalid && f['signatory1Name'].touched" class="error">
          Signatory name is required.
        </div>
      </div>

      <div class="form-group">
        <label>Signatory 1 Role*</label>
        <input type="text" formControlName="signatory1Role" />
        <div *ngIf="f['signatory1Role'].invalid && f['signatory1Role'].touched" class="error">
          Signatory role is required.
        </div>
      </div>

      <!-- Signatory 2 -->
      <div class="form-group" *ngIf="certificateForm.value.numberOfSignatories === '2'">
        <label>Signatory 2 Name*</label>
        <input type="text" formControlName="signatory2Name" />
        <div *ngIf="f['signatory2Name'].invalid && f['signatory2Name'].touched" class="error">
          Signatory name is required.
        </div>
      </div>

      <div class="form-group" *ngIf="certificateForm.value.numberOfSignatories === '2'">
        <label>Signatory 2 Role*</label>
        <input type="text" formControlName="signatory2Role" />
        <div *ngIf="f['signatory2Role'].invalid && f['signatory2Role'].touched" class="error">
          Signatory role is required.
        </div>
      </div>

      <div class="button-group">
        <button type="button" (click)="goBack()" class="btn secondary">Back</button>
        <button type="button" class="btn btn-req" (click)="openCertificatePreview()">Preview & Request Approval</button>
      </div>
    </form>
  </div>

  <!-- Right Panel - Certificate Preview -->
  <div class="preview-panel">
    <div class="certificate" [style.backgroundImage]="'url(/coe-bg.png)'">
      <div class="certificate-content">
         <!-- Company Logo and Name -->
        <div class="company-header">
            <img src="/its_logo.png" alt="Company Logo" class="company-logo" />
            <span class="company-name">IT Squarehub</span>
        </div>
        <h1>CERTIFICATE OF EMPLOYMENT</h1>

        <div class="cert-meta">
          <p class="issue-date">
            {{ certificateForm.value.issueDate ? (certificateForm.value.issueDate | date: 'MMMM d, y') : "Issued Date" }}
          </p>
          <p class="re-line">
            RE: <strong>Certificate of Employment</strong>
          </p>
        </div>

        <div class="certificate-text">
          <p>To Whom It May Concern,</p>

          <p style="text-align:justify; margin-top:1em;">
            This is to certify that <span class="font-bold">{{ certificateForm.value.recipientName }}</span>,
            with Employee ID #<span class="font-bold">{{ certificateForm.value.employeeId }}</span>,
            was employed with <span class="font-bold">IT Squarehub Global Services Corporation</span>
            from <span class="font-bold">{{ certificateForm.value.startDate | date: 'MMMM d, y' }}</span>
            to <span class="font-bold">{{ certificateForm.value.endDate | date: 'MMMM d, y' }}</span>.
          </p>

          <p style="text-align:justify; margin-top:1em;">
            The details of their employment during this period were as follows:
          </p>
          <ul>
            <li><span class="font-bold">{{ certificateForm.value.salaryWords }}</span> pesos (₱{{ certificateForm.value.salaryFigures | number:'1.2-2' }}) per month</li>
            <li><span class="font-bold">{{ certificateForm.value.position }}</span></li>
            <li><span class="font-bold">{{ certificateForm.value.employmentType }}</span></li>
          </ul>

           <p style="text-align:justify; margin-top:1em;">
                {{ certificateForm.value.recipientName }} was an active member of our team during their tenure and contributed
                to our organization's success. This certificate is issued at the request of the above-mentioned
                employee for their reference and any other legitimate purposes. For any further inquiries or verification, please feel free to contact us at
                <strong>{{ certificateForm.value.companyPhone || 'Company Phone' }}</strong> or via email at
                <a [href]="'mailto:' + (certificateForm.value.companyEmail || '')" class="email-link">
                  {{ certificateForm.value.companyEmail || 'Company Email' }}
                </a>.
              </p>
        </div>

        <!-- Signatures -->
        <div class="signatures" [class.single-signature]="certificateForm.value.numberOfSignatories === '1'">
          <div>
            <p class="sig-names">{{ certificateForm.value.signatory1Name || 'Signatory 1 Name' }}</p>
            <p class="sig-roles">{{ certificateForm.value.signatory1Role || 'HR Officer' }}</p>
            <p class="date-signed">{{ certificateForm.value.dateSigned ? (certificateForm.value.dateSigned | date: 'MMMM d, y') : "______________" }}
            </p>
          </div>

          <div *ngIf="certificateForm.value.numberOfSignatories === '2'">
            <p class="sig-names">{{ certificateForm.value.signatory2Name || 'Signatory 2 Name' }}</p>
            <p class="sig-roles">{{ certificateForm.value.signatory2Role || 'Co-Signatory' }}</p>
            <p class="date-signed">{{ certificateForm.value.dateSigned ? (certificateForm.value.dateSigned | date: 'MMMM d, y') : "______________" }}
            </p>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Preview & Approval Modal -->
  <div *ngIf="showCertificatePreview" class="popup-overlay">
    <div class="popup-content">
      <h3 style="margin-bottom: 1em;">Certificate Preview & Request Approval</h3>

      <!-- Certificate Capture -->
      <div class="capture-container">
        <div #modalCertificate class="certificate" [style.backgroundImage]="'url(/coe-bg.png)'">
          <div class="certificate-content">
             <!-- Company Logo and Name -->
            <div class="company-header">
                <img src="/its_logo.png" alt="Company Logo" class="company-logo" />
                <span class="company-name">IT Squarehub</span>
            </div>
            <h1>CERTIFICATE OF EMPLOYMENT</h1>
            <div class="cert-meta">
              <p class="issue-date">
                {{ certificateForm.value.issueDate ? (certificateForm.value.issueDate | date: 'MMMM d, y') : "Issued Date" }}
              </p>
              <p class="re-line">
                RE: <strong>Certificate of Employment</strong>
              </p>
            </div>

            <div class="certificate-text">
              <p>To Whom It May Concern,</p>
              <p style="text-align:justify; margin-top:1em;">
                This is to certify that <span class="font-bold">{{ certificateForm.value.recipientName }}</span>,
                with Employee ID #<span class="font-bold">{{ certificateForm.value.employeeId }}</span>,
                was employed with <span class="font-bold">IT Squarehub Global Services Corporation</span>
                from <span class="font-bold">{{ certificateForm.value.startDate | date: 'MMMM d, y' }}</span>
                to <span class="font-bold">{{ certificateForm.value.endDate | date: 'MMMM d, y' }}</span>.
              </p>
              <p style="text-align:justify; margin-top:1em;">
                The details of their employment during this period were as follows:
              </p>
              <ul>
                <li><span class="font-bold">{{ certificateForm.value.salaryWords }}</span> pesos (₱{{ certificateForm.value.salaryFigures | number:'1.2-2' }}) per month</li>
                <li><span class="font-bold">{{ certificateForm.value.position }}</span></li>
                <li><span class="font-bold">{{ certificateForm.value.employmentType }}</span></li>
              </ul>

              <p style="text-align:justify; margin-top:1em;">
                {{ certificateForm.value.recipientName }} was an active member of our team during their tenure and contributed
                to our organization's success. This certificate is issued at the request of the above-mentioned
                employee for their reference and any other legitimate purposes. For any further inquiries or verification, please feel free to contact us at
                <strong>{{ certificateForm.value.companyPhone || 'Company Phone' }}</strong> or via email at
                <a [href]="'mailto:' + (certificateForm.value.companyEmail || '')" class="email-link">
                  {{ certificateForm.value.companyEmail || 'Company Email' }}
                </a>.
              </p>
            </div>

            <!-- Signatures with Date Signed in Modal -->
            <div class="signatures" [class.single-signature]="certificateForm.value.numberOfSignatories === '1'">
              <div>
                <p class="sig-names">{{ certificateForm.value.signatory1Name || 'Signatory 1 Name' }}</p>
                <p class="sig-roles">{{ certificateForm.value.signatory1Role || 'HR Officer' }}</p>
                <p class="date-signed">{{ certificateForm.value.dateSigned ? (certificateForm.value.dateSigned | date: 'MMMM d, y') : "______________" }}</p>
              </div>
              <div *ngIf="certificateForm.value.numberOfSignatories === '2'">
                <p class="sig-names">{{ certificateForm.value.signatory2Name || 'Signatory 2 Name' }}</p>
                <p class="sig-roles">{{ certificateForm.value.signatory2Role || 'Co-Signatory' }}</p>
                <p class="date-signed">{{ certificateForm.value.dateSigned ? (certificateForm.value.dateSigned | date: 'MMMM d, y') : "______________" }}</p>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Dynamic Approval Form -->
      <form [formGroup]="approvalForm" (ngSubmit)="submitApprovalFromPreview()">
        <div *ngFor="let signatory of signatories; let i = index">
          <div class="form-group">
            <label>Approver {{ i + 1 }} Name*</label>
            <input type="text" [formControlName]="'approverName' + i" />
            <div *ngIf="approvalForm.get('approverName' + i)?.invalid && approvalForm.get('approverName' + i)?.touched" class="error">
              Name is required.
            </div>
          </div>
          <div class="form-group">
            <label>Approver {{ i + 1 }} Email*</label>
            <input type="email" [formControlName]="'approverEmail' + i" />
            <div *ngIf="approvalForm.get('approverEmail' + i)?.invalid && approvalForm.get('approverEmail' + i)?.touched" class="error">
              Valid email is required.
            </div>
          </div>
        </div>

        <div class="form-group">
          <label>Creator Name*</label>
          <input type="text" formControlName="creatorName" />
          <div *ngIf="approvalForm.get('creatorName')?.invalid && approvalForm.get('creatorName')?.touched" class="error">
            Creator name is required.
          </div>
        </div>

        <div class="modal-actions">
          <button type="submit" class="btn btn-req">Submit for Approval</button>
          <button type="button" (click)="closeCertificatePreview()" class="btn close-btn">Close</button>
        </div>
      </form>
    </div>
  </div>
</div>
