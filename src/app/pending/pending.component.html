<main class="main-content p-6 w-full bg-gray-100 min-h-screen">
  <!-- Access Denied State -->
  <div *ngIf="accessDenied" class="text-center text-red-600 font-bold text-lg mt-10">
    You do not have permission to access this page.
  </div>

  <!-- Certificate Table + Modal (only if access allowed) -->
  <div *ngIf="!accessDenied">
    <h2 class="text-center text-xl sm:text-2xl font-semibold text-blue-900 mb-6 tracking-wide uppercase">
      List of Pending Certificates
    </h2>

    <div class="overflow-x-auto rounded-lg shadow-md">
      <table class="min-w-full bg-white rounded-lg text-gray-800 text-sm">
        <thead class="bg-yellow-200 text-yellow-900">
          <tr>
            <th class="py-3 px-4 text-left font-semibold">Recipient</th>
            <th class="py-3 px-4 text-left font-semibold">Creator</th>
            <th class="py-3 px-4 text-left font-semibold">Signatory 1</th>
            <th class="py-3 px-4 text-left font-semibold">Signatory 2</th>
            <th class="py-3 px-4 text-left font-semibold">Issue Date</th>
            <th class="py-3 px-4 text-left font-semibold">Status</th>
            <th class="py-3 px-4 text-center font-semibold w-24">Action</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let cert of pendingCertificates" class="border-b hover:bg-yellow-50 transition">
            <td class="py-3 px-4">{{ cert.rname }}</td>
            <td class="py-3 px-4">{{ cert.creator_name }}</td>
            <td class="py-3 px-4">{{ cert.signatory1_name }}</td>
            <td class="py-3 px-4">{{ cert.signatory2_name }}</td>
            <td class="py-3 px-4">{{ cert.issue_date }}</td>
            <td class="py-3 px-4 capitalize">{{ cert.status }}</td>
            <td class="py-3 px-4 text-center">
              <button
                title="Review Certificate"
                (click)="openModal(cert)"
                class="bg-yellow-600 hover:bg-yellow-700 text-white w-9 h-9 rounded-full flex items-center justify-center shadow-md transition">
                <i class="fa fa-eye text-sm"></i>
              </button>
            </td>
          </tr>
        </tbody>
      </table>
    </div>

    <!-- Review Modal -->
    <div *ngIf="showModal" class="fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50">
      <div class="bg-white p-6 rounded-lg shadow-lg w-[1200px] max-h-[90vh] overflow-y-auto relative">
        <button class="absolute top-3 right-3 text-gray-500 hover:text-black" (click)="closeModal()">&times;</button>

        <!-- Certificate Preview -->
        <div class="mb-4">
          <div class="flex justify-center">
            <p class="text-3xl font-extrabold mb-8">CERTIFICATE PREVIEW</p>
          </div>

          <div #certificateContainer class="relative w-full max-w-4xl mx-auto">
            <img
              [src]="selectedCert?.png_path || 'assets/placeholder-cert.png'"
              alt="Certificate Preview"
              class="w-full max-w-[2000px] max-h-[2000px] object-contain mx-auto rounded" />

            <!-- Signature Overlay (Draggable & Resizable) -->
            <div
              *ngIf="signaturePreview"
              class="absolute border border-transparent"
              [ngStyle]="{
                top: signaturePosition.y + 'px',
                left: signaturePosition.x + 'px',
                width: signatureSize.width + 'px',
                height: signatureSize.height + 'px'
              }"
              (mousedown)="startDrag($event)"
              style="cursor: move;">
              <img
                [src]="signaturePreview"
                alt="Signature"
                class="w-full h-full object-contain pointer-events-none select-none" />
              <div
                class="absolute bottom-0 right-0 w-4 h-4 bg-transparent cursor-se-resize"
                (mousedown)="startResize($event)"
                data-html2canvas-ignore="true">
              </div>

            </div>
          </div>
        </div>

        <!-- Action Buttons -->
        <div class="flex justify-center mt-4 gap-4">
          <button
            (click)="approveCert(selectedCert)"
            class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded">
            Approve
          </button>
          <button
            (click)="rejectCert(selectedCert)"
            class="bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded">
            Reject
          </button>
          <label
            class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded cursor-pointer">
            Import E-Signature
            <input
              type="file"
              accept="image/png, image/jpeg"
              (change)="onSignatureUpload($event)"
              hidden />
          </label>
        </div>
      </div>
    </div>
  </div>
</main>
